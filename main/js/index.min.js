/*hello 这是用gulp插件完成的css合并、压缩、注释等，一些列工作*/
function Z_init(){function e(){$(o.ele.mask).remove(),$(o.ele.nav).remove(),$(o.ele.dialog).remove()}var i,a,o=this,n="host",s=1,d=0,r=60,l=99,c=[],p=[],u={},m={};this.ele={mask:$("<div class='weui-mask'>")[0],nav:$('<div class="weui-navbar act_rl">                   <div class="weui-navbar__item" id="btn_repo" style="display:none"><i class="iconfont icon-fenxiang"></i>引用</div>                    <div class="weui-navbar__item" id="btn_star"><i class="iconfont icon-xihuan"></i><span id="hasRetort"></span></div>                    <div class="weui-navbar__item btn_comment"><i class="iconfont icon-pinglun"></i>评论</div>               </div>')[0],speak:$('<div class="speak">                   <a href="javascript:;" class="weui-btn weui-btn_primary btn_comment" dataType="0">发言</a>                 </div>')[0],recordLoding:$('<div >                <div class="weui-mask_transparent"></div>                <div class="weui-toast" id="recordLodingTosat">                    <i class="weui-loading weui-icon_toast"></i>                    <p class="weui-toast__content" id="recordLodingNum"></p>                    <p class="weui-toast__content">点击停止录音</p>                </div>            </div>')[0],nowLoding:$('<div class="weui-loadmore">                    <i class="weui-loading"></i>                    <span class="weui-loadmore__tips">正在加载</span>                </div>')[0],dialog:"",preview:""},this.bkblInfo={},this.data={uid:1000010012,talk_id:TID,xopenid:XID,author:AU},this.cl={},this.init=function(){o.get_userInfo(),o.event()},this.event=function(){$DB.on("click",function(i){switch(i.target){case o.ele.mask:e()}}),$DB.on("click","#main_navbar .weui-navbar__item",function(e){var i=$(this).attr("dataType");if("block"!=$(z_init.ele.nowLoding).css("display")||i!=n)switch(n=i,$(this).addClass("weui-bar__item_on").siblings().removeClass("weui-bar__item_on"),$(o.ele.speak).remove(),$("#chatBox").html("").append(o.ele.nowLoding),l=99,i){case"wonder":s=1,o.get_wonderList({page:s});break;case"host":o.get_presideList();break;case"chat":3!=o.bkblInfo.sright&&$(".page").append(o.ele.speak),o.get_chatList()}}),$DB.on("click",".btn_getTools",function(e){e.stopPropagation();var a=$(this).closest(".weui-media-box_appmsg").attr("dataType");d=JSON.parse(decodeURIComponent(a)),i=$(this).closest(".weui-media-box_appmsg");var t=d.retort?"取消":"点赞";$(o.ele.mask).css("opacity","0"),$(this).after(o.ele.mask),$(this).after(o.ele.nav),$("#hasRetort").html(t)}),$DB.on("click","#btn_repo",function(i){i.stopPropagation(),e(),console.log("引用")}),$DB.on("click","#btn_star",function(i){i.stopPropagation(),e(),d.retort?o.del_retort():o.send_retort()}),$DB.on("click",".btn_reComment",function(e){e.stopPropagation();var a=$(this).closest(".weui-media-box_appmsg").attr("dataType"),t={type:"repo"};3!=o.bkblInfo.cright?(d=JSON.parse(decodeURIComponent(a)),i=$(this).closest(".weui-media-box_appmsg"),o.ele.comment=o.dom_comment(t),$DB.append(o.ele.comment),$(o.ele.comment).slideDown("fast")):alert("管理员限制评论")}),$DB.on("click",".btn_comment",function(i){if(i.stopPropagation(),!o.btnonOFF){o.btnonOFF=1,e();var a={type:"repo"};if(0==$(this).attr("dataType")&&(d=0,a="",c=[],"wonder"==n&&(d=1,a={type:"repo"})),""!=a&&3==o.bkblInfo.cright)return delete o.btnonOFF,void alert("管理员限制评论");o.ele.comment=o.dom_comment(a),$DB.append(o.ele.comment),$(o.ele.comment).slideDown("fast",function(){delete o.btnonOFF})}}),$DB.on("click",".rep_del",function(e){e.stopPropagation();var a=(i=$(this).closest(".weui-media-box_appmsg")).attr("dataType"),t=JSON.parse(decodeURIComponent(a));o.ele.dialog=o.dom_dialog({fun:function(){o.del_chat(t)}}),$DB.append(o.ele.mask),$DB.append(o.ele.dialog)}),$DB.on("click","#btn_voice",function(e){function i(){if(0==r)return o.ele.recordLoding.remove(),o.weixin.record.stop({fun:o.weixin.record.upload}),void(r=60);$("#recordLodingNum").html("录音中 ("+r+"s)"),r--,t=setTimeout(function(){i()},1e3)}wx.startRecord(),$DB.append(o.ele.recordLoding),i()}),$DB.on("click","#recordLodingTosat",function(e){r=0}),$DB.on("click",".btn_playRecord",function(e){var i=$(this).attr("dataType"),a=$(this).find(".audioPlaying")[0];if(o.voice_playing){var t=o.voice_playEle,n=o.voice_playId;$(t).hide(),delete o.voice_playId,delete o.voice_playing,delete o.voice_playEle,wx.stopVoice({localId:n})}else o.voice_playing=!0,o.voice_playEle=a,o.weixin.record.download({id:i,fun:function(e){$(a).show(),o.voice_playId=e,wx.playVoice({localId:e})}})}),$DB.on("click",".btn_playRecord2",function(e){var i=$(this).siblings("audio")[0];o.audio_playing?i!=o.audio_playEle?(o.audio_playEle.pause(),i.play()):o.audio_playEle.pause():i.play()}),$DB.on("ended","audio",function(e){alert("自动播放结束")}),$DB.on("play","audio",function(e){alert("自动播放开始")}),$DB.on("click","#btn_picture",function(e){1!=c.length?o.weixin.img.choose({fun:function(e){var i=e;o.weixin.img.upload({id:i[0],fun:function(e){var i=e;o.weixin.img.download({id:i,fun:function(e){var a=e;if(c.push(i),window.__wxjs_is_wkwebview)wx.getLocalImgData({localId:a,success:function(e){var a='<li class="weui-uploader__file" style="text-align:center;overflow:hidden;background:#000"><img src="'+e.localData+'" style="max-height:100%;" class="btn_preview" dataType="'+i+'"></li>';$("#uploaderFiles").append($(a))}});else{var t='<li class="weui-uploader__file" style="text-align:center;overflow:hidden;background:#000"><img src="'+a+'" style="max-height:100%;" class="btn_preview" dataType="'+i+'"></li>';$("#uploaderFiles").append($(t))}}})}})}}):alert("已上传图片")}),$DB.on("click",".btn_preview",function(e){var i={src:$(this).attr("src"),style:"style='display:none'"},a=$(this).attr("dataType")||"",t=this;""!=a&&(i.style="style='display:block'",m={id:a,ele:t}),o.ele.preview=o.dom_preview(i),$DB.append(o.ele.preview)}),$DB.on("click","#previewImg",function(e){$(o.ele.preview).fadeOut(function(){$(this).remove()})}),$DB.on("click","#btn_delImg",function(e){e.stopPropagation();var i=m.id,a=m.ele;arrayDel(c,i),$(a).remove(),$(o.ele.preview).fadeOut(function(){$(this).remove()})}),$DB.on("change",".uploaderInput",function(e){for(var i,a=window.URL||window.webkitURL||window.mozURL,t=e.target.files,o=0,n=t.length;o<n;++o){var s=t[o];i=a?a.createObjectURL(s):e.target.result,$("#uploaderFiles").append($('<li class="weui-uploader__file" style="background-image:url(#url#)"></li>'.replace("#url#",i)))}}),$DB.on("click","#btn_send",function(e){var i="";0==d?(c.length>0&&(i={type:1,msg:c.join("|")}),o.send_words(i)):1==d?o.send_wonder():o.send_repo()}),$DB.on("click","#btn_commentBack",function(e){$(o.ele.comment).slideUp("fast",function(){o.toggle_video(),$(o.ele.comment).remove()})}),$DB.on("click","#btn_more",function(e){switch($(this).after(o.ele.nowLoding).remove(),n){case"host":o.get_presideList({id:a});break;case"wonder":s+=1,o.get_wonderList({page:s});break;case"chat":o.get_chatList({id:a})}}),$DB.on("click","#btn_playVideo",function(e){o.playVideo()}),$DB.on("click",".btn_chatMsg",function(e){2==$(this).css("-webkit-line-clamp")?$(this).css("-webkit-line-clamp","initial"):$(this).css("-webkit-line-clamp","2")}),$DB.on("click",".btn_broad",function(e){var i=$(this).attr("dataType");i=JSON.parse(decodeURIComponent(i));var a=o.dom_broad(i)[0];$DB.append(a),$(a).fadeIn("fast")}),$DB.on("click","#btn_broadBd",function(e){$(this).fadeOut("fast",function(){this.remove()})}),$DB.on("click",".btn_playView",function(e){var i='<iframe class="viewVideo"  frameborder="0" src="./playMp4.html?source='+$(this).attr("dataType")+'"></iframe>';$(this).closest(".viewType").html(i)}),$DB.on("click",".btn_wonder",function(e){var i=$(this).attr("dataType");i=JSON.parse(i),invoke({data:{m:params.getWonder,id:i.id,talk_id:o.data.talk_id,xopenid:o.data.xopenid,author:o.data.author},fun:function(e){(u=e).id=i.id;var a=o.dom_wonder(e)[0];$DB.append(a),$(a).fadeIn("fast",function(){$(a).append(o.ele.speak)})}})}),$DB.on("click",".btn_wonderRet",function(e){e.stopPropagation();var i=$(this).closest(".btn_wonder").attr("dataType");i=JSON.parse(i);var a=$(this).find("span").html()||0,t=$(this).find("span"),n={m:params.wonderRetort,cid:i.id,talk_id:o.data.talk_id,xopenid:o.data.xopenid,author:o.data.author};invoke({data:n,fun:function(e){$(t).html(parseInt(a)+1)},err:function(e){n.id=i.id,n.m=params.wonderDelRetort,invoke({data:n,fun:function(e){var i=parseInt(a)-1||"";$(t).html(i)}})}})}),$DB.on("click","#wonderBack",function(e){$("#wonderBd").fadeOut("fast",function(){o.toggle_video(),this.remove()})})},this.weixin={record:{stop:function(e){var i=(e||{}).fun;wx.stopRecord({success:function(e){localId=e.localId,i({id:localId})}})},upload:function(e){var i=(e||{}).id;wx.uploadVoice({localId:i,isShowProgressTips:1,success:function(e){var i=e.serverId;o.ele.dialog=o.dom_dialog({msg:"确认提交录音？",fun:function(){var e={type:2,msg:i};0==d?o.send_words(e):o.send_repo(e)}}),$DB.append(o.ele.mask),$DB.append(o.ele.dialog)}})},download:function(e){var i=e||{},a=i.id,t=i.fun;wx.downloadVoice({serverId:a,isShowProgressTips:1,success:function(e){var i=e.localId;t(i)}})}},img:{upload:function(e){var i=e||{},a=i.id,t=i.fun||function(){};wx.uploadImage({localId:a,isShowProgressTips:1,success:function(e){var i=e.serverId;t(i)}})},choose:function(e){var i=(e||{}).fun||function(){};wx.chooseImage({count:1,success:function(e){var a=e.localIds;i(a)}})},download:function(e){var i=e||{},a=i.id,t=i.fun||function(){},o=i.fun2||function(){};wx.downloadImage({serverId:a,isShowProgressTips:0,success:function(e){var i=e.localId;t(i)},complete:function(e){var i=e.localId;o(i)}})}}},this.dom_chatLine=function(e){var i=e||{},t=i.head,n=i.nickname,s=i.message||"",d=1==s.split("|").length?s:s.split(".,")[1],r=i.rtype||"",l=i.type||"",c=i.video||"",p=i.image||"",u=i.date,m=i.top||"",_=i.id,v=i.province||"",h=i.uid,w=i.comment||"",f=i.retort||"",g=o.data.uid==h?"inline-block":"none",b=m?'<span class="weui-badge badge-top">置顶</span>':"",y=w?o.dom_repo(w,_,n)[1]:"",x=f?o.dom_retort(f)[1]:"",k={id:_,uid:"",type:"speak",retort:0==o.dom_retort(f)[2].length?0:o.dom_retort(f)[2]},I="";switch(parseInt(r)){case 1:var _=s.split("|")[1],B=s.split("|")[0],T="";T+="0"==i.fstatus?'<p class="weui-media-box__desc"><img src="http://file.api.weixin.qq.com/cgi-bin/media/get?access_token='+atoken+"&media_id="+_+'" class="btn_preview"  onerror="imgError(this,\'./img/overtime.png\',{width:80,height:40})"></p>':'<p class="weui-media-box__desc"><img src="'+i.path+'" class="btn_preview"  onerror="imgError(this,\'./img/overtime.png\',{width:80,height:40})"></p>',textHtml='<p class="weui-media-box__desc">'+b+B+"</p>",I=textHtml+T;break;case 2:I="0"==i.fstatus?'<p class="weui-media-box__desc">'+b+'<a class="btn_playRecord" dataType="'+d+'"><i class="audioIcon"><img src="./img/audio.png"></i><i class="audioPlaying" style="display:none"></i><span class="s-arrow"></span></a></p>':'<p class="weui-media-box__desc">'+b+'<audio src="'+i.path+'" style="width:40px;height:20px" onended="z_init.audio_stop(this)" onpause="z_init.audio_stop(this)" onplay="z_init.audio_play(this)"></audio><a class="btn_playRecord2" dataType="'+d+'"><i class="audioIcon"><img src="./img/audio.png"></i><i class="audioPlaying" style="display:none"></i><span class="voiceTime"></span><span class="s-arrow"></span></a></p>';break;case 0:I='<p class="weui-media-box__desc  btn_chatMsg">'+b+decodeURIComponent(d)+"</p>"}switch(parseInt(l)){case 1:var D="";p&&(D='<p class="weui-media-box__desc  btn_chatMsg"><img src="'+p+'" class="btn_preview" onerror="imgError(this,\'./img/overtime.png\',{width:80,height:40})"></p>'),I+='<p class="weui-media-box__desc  btn_chatMsg">'+b+decodeURIComponent(d)+"</p>"+D;break;case 3:I+='<p class="weui-media-box__desc  btn_chatMsg">'+b+decodeURIComponent(d)+'</p><div class="viewType" ><div class="viewBox"><img src="'+p+'" style="height:200px;max-width:100%" onerror="imgError(this)"><span class="btn_playView" dataType="'+c+' "><i class="iconfont icon-bofang1"></i></span></div></div>';break;case 4:I+='<p class="weui-media-box__desc  btn_chatMsg">'+b+decodeURIComponent(d)+'</p><div class="viewType"><a href="'+c+'"><i class="iconfont icon-lianjie"></i>'+p+"</a></div>"}var S='<div class="weui-media-box weui-media-box_appmsg weui-media-box_appmsg_1" dataType="'+encodeURIComponent(JSON.stringify(k))+'">                                <div class="weui-media-box__hd">                                    <img class="weui-media-box__thumb" src="'+t+'" alt="">                                </div>                                <div class="weui-media-box__bd">                                    <span class="rep_city">'+v+'</span>                                    <h4 class="weui-media-box__title">'+n+"</h4>                                    "+I+'                                    <div class="rep_info">                                        <p class="rep_time">'+u+'</p>                                        <a class="rep_del" style="display:'+g+'">删除</a>                                        <div class="rep_tag btn_getTools"><i class="iconfont icon-gengduo"></i></div>                                    </div>                                    '+x+y+"                                </div>                            </div>";$(S);return a=i.id,$(S)[0]},this.init_part=function(e){var i=e;if(o.get_broadList(),2==i.model){for(var a=i.source,t='<div class="swiper-container2"><div class="swiper-wrapper">',n=0;n<a.length;n++){var s=a[n];t+='<div class="swiper-slide"><a class="swiper2-slide-a" '+(""==s.url?"":"href='"+s.url+"'")+'><img src="'+s.image+'""></a></div>'}t+="</div></div>";$("#video").html(t+'<script>                                   var mySwiper2 = new Swiper(".swiper-container2", {                                                        autoplay: 5000,                                                    });                                <\/script>')}else $("#video").html('<img src="'+i.image+'" style="height:100%;margin: 0 auto;display: block;"><span id="btn_playVideo"><i class="iconfont icon-bofang1"></i></span>');var d="",r="",l='<a class="weui-navbar__item" dataType="chat">聊天</a>';$("#chatBox").html("").append(o.ele.nowLoding),$(o.ele.speak).remove(),1==i.subject?(d='<a class="weui-navbar__item weui-bar__item_on" dataType="host">主持</a>',o.get_presideList(),1==i.special&&(r='<a class="weui-navbar__item" dataType="wonder">精彩</a>')):1==i.special?(r='<a class="weui-navbar__item weui-bar__item_on" dataType="wonder">精彩</a>',o.get_wonderList()):(l='<a class="weui-navbar__item  weui-bar__item_on" dataType="chat">聊天</a>',3!=o.bkblInfo.sright&&$(".page").append(o.ele.speak),o.get_chatList()),$("#main_navbar").html(d+r+l),ws.hasInit||(ws.send('{"talk_id":"'+TID+'","cmdtype":"getchatinfo","from":"wxchatxiaomai","to":"wxchatxiaomai","rtype":0}'),ws.hasInit=!0)},this.dom_repo=function(e,i,a){for(var t=e||{},n=i||"",s=a||"",t=t.list||[],d="",r='<div class="rep_item">',l=0;l<t.length;l++){var c=t[l].head,p=t[l].nickname,u=t[l].rnickname||"",m=t[l].uid||"",i=t[l].id||0,_=t[l].message,v=m==o.data.uid?"inline-block":"none",h={id:i,uid:m,type:"repo",_id:n,_name:s,pid:i},w="";u&&(w=' <span style="margin-right: 0.2em;color: #999;font-weight: 400;display:inline-block;margin-left: -0.2em;">回复'+u+":</span>"),r+=' <div class="weui-media-box weui-media-box_appmsg" dataType="'+encodeURIComponent(JSON.stringify(h))+'">                                <div class="weui-media-box__hd">                                    <img class="weui-media-box__thumb" src="'+c+'" alt="">                                </div>                                <div class="weui-media-box__bd btn_reComment">                                    <h4 class="weui-media-box__title">'+p+'<a class="rep_del" style="margin-left:10px;color:#999;font-weight:400;display:'+v+'">删除</a></h4>                                    <p class="weui-media-box__desc">'+w+decodeURIComponent(_)+"</p>                                </div>                             </div>"}return d='<div class="rep_box rep_box_repo"><div class="rep_tag"><i class="iconfont icon-pinglun"></i></div>'+(r+="</div>")+"</div>",[$(d)[0],d]},this.dom_retort=function(e){for(var i=e.list||[],a="",t="",n=[],s=0;s<i.length;s++){var d=i[s].head;o.data.uid==i[s].uid&&(!0,n.push(i[s].id),t="retort_"+i[s].id),a+='<img class="rep_head" src="'+d+'" id="'+t+'">'}var r='<div class="rep_box rep_box_retort">                            <div class="rep_tag">                                <i class="iconfont icon-xihuan"></i>                            </div>                            <div class="rep_item" style="padding:4px 4px 0;">'+a+"</div>                    </div>";return[$(r)[0],r,n]},this.dom_comment=function(e){var i,a="repo"==((e||{}).type||"")?'style="display:none"':"";i='<div class="page" style="display:none">                        <div class="comment">                            <div class="weui-cell" '+a+'>                                <div class="weui-cell__bd" >                                     <div class="weui-uploader__bd">                                        <ul class="weui-uploader__files" id="uploaderFiles">                                        </ul>                                    </div>                                </div>                            </div>                            <div class="weui-cells weui-cells_form">                                <div class="weui-cell">                                    <div class="weui-cell__bd">                                        <textarea class="weui-textarea" placeholder="这一刻你想说的。。" rows="3" id="emoji"></textarea>                                    </div>                                </div>                            </div>                        </div>                        <div class="weui-navbar comment_nav" '+a+'>                            <div class="weui-navbar__item" id="btn_voice">                                <i class="iconfont icon-changge"></i>语音                            </div>                            <div class="weui-navbar__item" id="btn_picture">                                <i class="iconfont icon-paizhao"></i>照片                            </div>                        </div>                        <div class="comment_btnBox">                            <a href="javascript:;" class="weui-btn weui-btn_primary" id="btn_send">发布</a>                            <a href="javascript:;" class="weui-btn weui-btn_default" id="btn_commentBack">返回</a>                        </div>                    </div>';var t=$(i);return $emoji=t.find("#emoji"),o.ele.emoji=$emoji[0],o.toggle_video(1),t[0]},this.dom_dialog=function(i){var a=i||{},t=a.msg||"确定要删除发言吗？",o=a.fun||function(){},n='<div class="weui-dialog">                        <div class="weui-dialog__hd"><i class="weui-icon-warn weui-icon_msg-primary" style="font-size: 80px;margin-bottom: 12px;"></i></div>                        <div class="weui-dialog__bd">'+t+'</div>                        <div class="weui-dialog__ft">                            <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default" id="dialog_false">取消</a>                            <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary" id="dialog_true">确定</a>                        </div>                    </div>',s=$(n),d=s.find("#dialog_false"),r=s.find("#dialog_true");return d.on("click",function(){e()}),r.on("click",function(){e(),o()}),s[0]},this.dom_preview=function(e){var i=e||{},a='<div class="weui-gallery" style="display:block">                        <span class="weui-gallery__img" id="previewImg" style="background-image:url('+i.src+')"></span>                        <div class="weui-gallery__opr">                            <a href="javascript:" class="weui-gallery__del" id="btn_delImg" '+(i.style||"")+'>                                <i class="weui-icon-delete weui-icon_gallery-delete"></i>                            </a>                        </div>                    </div>';return $(a)[0]},this.dom_wonderList=function(e){for(var i=e||{},a="<div>",t=0;t<i.length;t++){var o=i[t],n=(o.id,o.image),s=o.title,d=(o.message,o.date||""),r=o.top,l=o.retort?o.retort.total:0,c=(o.comment&&o.comment.total,r?'<span class="weui-badge badge-top">置顶</span>':"");a+='<div class="weui-cell btn_wonder" dataType=\''+JSON.stringify(o)+'\'>                        <div class="weui-cell__hd" style="margin-right:8px;height:50px;"><img src="'+n+'"  onerror="imgError(this,\'./img/nopic2.jpg\')" style="width: 80px;height:50px;"></div>                        <div class="weui-cell__bd">                            <p class="wonder_p">'+c+s+'</p>                            <p style="font-size: 12px;color: #888;text-indent:0.2em">'+d+'</p>                        </div>                        <div class="weui-cell__ft "><a class="btn_wonderRet"><i class="iconfont icon-xihuan"></i><span>'+l+"</span></a></div>                    </div>"}return a+="</div>",[$(a)[0],a]},this.dom_broad=function(e){var i=e||{},a=i.title,t=i.image,o='<div class="page" style="display:none" id="btn_broadBd">                    <div class="page__bd">                            <article class="weui-article" style="padding-top:20px;">                                    <section>                                       <p style="text-align:center"> '+a+'</p>                                       <h3 style="text-align:right"><a style="float:left;color:#1b5e94">返回</a><a style="color:#1b5e94" href="'+i.url+'">点击跳转</a></h3>                                        <p style="text-align:center">                                           <img src="'+t+'" alt="">                                        </p>                                    </section>                            </article>                        </div>                    </div>';return[$(o)[0],o]},this.dom_wonder=function(e){var i=e||{},a=i.title,t=i.video,n=i.message,s=i.image,d=i.date,r=i.comment,l=i.comment?i.comment.total:"0",c=i.retort?i.retort.total:"0",p=$("<div></div>");if(""!=r){for(var u=0;u<r.list.length;u++){var m=r.list[u];p.append(o.dom_chatLine(m))}r=p.html()}else r='<div class="weui-loadmore weui-loadmore_line"><span class="weui-loadmore__tips">暂无评论</span></div>';var _='<div class="page" style="display:none" id="wonderBd">                    <div class="page__bd">                            <div id="wonderVideo" class="viewType"><img src="'+s+'" alt="" style="width:100%" onerror="imgError(this,\'./img/nopic2.jpg\')">                            <span class="btn_playView" dataType="'+t+'"><i class="iconfont icon-bofang1"></i></span></div>                            <article class="weui-article">                                    <section>                                        <section style=" border-bottom: 1px  groove #ddd;">                                            <h2 style="overflow:hidden">标题：'+a+'<a href="javascript:;" id="wonderBack">返回</a></h2>                                            <h3>'+d+' <i class="iconfont icon-xihuan ">'+c+'</i><i class="iconfont icon-pinglun">'+l+'</i></h3>                                            <p id="wonderMsg" class="btn_chatMsg">简介：'+n+'</p>                                        </section>                                        <section>                                            <h3>留言板：</h3>                                            <div style="zoom:0.8" id="wonderChat">'+r+"</div>                                        </section>                                    </section>                            </article>                        </div>                    </div>",v=$(_);return o.toggle_video(1),[v[0],_]},this.passwd_dom=function(e){var i='<div class="page"  id="passwdBd">                    <div class="weui-mask"></div>                    <div class="weui-dialog">                        <div class="weui-dialog__hd"><strong class="weui-dialog__title">请输入房间密码</strong></div>                        <div class="weui-dialog__bd" ><input class="weui-input" type="text" placeholder="请输入密码" style="padding:6px 2px;border:1px solid #ccc" id="passwd"></div>                        <div class="weui-dialog__ft">                            <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary" id="btn_pass">确认</a>                        </div>                </div></div>';return[$(i)[0],i]},this.refresh_chat=function(e){for(var i=e||{},a=0;a<i.length;a++)$("#chatBox").append(o.dom_chatLine(i[a]))},this.get_userInfo=function(){var e=o.data;invoke({data:{m:params.userInfo,talk_id:e.talk_id,xopenid:e.xopenid,author:e.author},fun:function(e){var i=e;$.extend(!0,o.data,i),o.get_bkbl()}})},this.get_bkbl=function(){var e=o.data;invoke({data:{m:params.bkbl,talk_id:e.talk_id,xopenid:e.xopenid,author:e.author},fun:function(e){o.bkblInfo=e,o.checkPW(e)}})},this.checkPW=function(e){var i=e||{};if(i.pass){if(i.pass==PW){if(+new Date-parseInt(PWT)<864e5)return void o.init_part(i)}var a=o.passwd_dom();return $DB.append(a[0]),void $DB.on("click","#btn_pass",function(e){var i=$("#passwd").val(),a=$('<div id="loadingToast" style=" display: none;">                                        <div class="weui-mask_transparent"></div>                                        <div class="weui-toast">                                            <i class="weui-loading weui-icon_toast"></i>                                            <p class="weui-toast__content">数据加载中</p>                                        </div>                                    </div>'),t=$('<div id="loadingToast" style=" display: none;">                                        <div class="weui-mask_transparent"></div>                                        <div class="weui-toast">                                            <i class="weui-loading weui-icon_toast"></i>                                            <p class="weui-toast__content">密码错误！</p>                                        </div>                                    </div>');i==o.bkblInfo.pass?(localStorage.setItem("homePW",i),localStorage.setItem("homePW_time",+new Date),$("#passwdBd").append(a),a.fadeIn(100),setTimeout(function(){a.fadeOut(100),$("#passwdBd").remove()},1e3),o.init_part(o.bkblInfo)):($("#passwdBd").append(t),t.fadeIn(100),setTimeout(function(){t.fadeOut(100)},1e3))})}o.init_part(i)},this.get_presideList=function(e){var i=e||{},a=i.id||0,t=i.num||5,n={talk_id:o.data.talk_id,xopenid:o.data.xopenid,author:o.data.author};n.id=a,n.num=t,n.m=params.presideList,n.top=l,invoke({url:"",data:n,fun:function(e){var i=$("#main_navbar a[dataType='host']").find("span");if("dom"==typeOf(i[0])){var a=i.html();console.log(a),WSnum.host=parseInt(WSnum.host)+parseInt(a)}if(i.remove(),e){if(o.refresh_chat(e),e.length>=t)return $("#chatBox").append('<a href="javascript:;" class="weui-btn weui-btn_default " id="btn_more">加载更多</a>'),void $(o.ele.nowLoding).remove();if(""==l){s=$("#btn_more")[0];return"dom"==typeOf(s)&&$(s).remove(),$("#chatBox").append('<div class="weui-loadmore weui-loadmore_line"><span class="weui-loadmore__tips">暂无数据</span></div>'),void $(o.ele.nowLoding).remove()}l="",n.num=t-e.length,n.id="0",o.get_presideList(n)}else{if(!l){var s=$("#btn_more")[0];return"dom"==typeOf(s)&&$(s).remove(),$("#chatBox").append('<div class="weui-loadmore weui-loadmore_line"><span class="weui-loadmore__tips">暂无数据</span></div>'),void $(o.ele.nowLoding).remove()}l="",n.num=t,n.id="0",o.get_presideList(n)}}})},this.get_chatList=function(e){var i=e||{},a=i.id||0,t=i.num||5,n={talk_id:o.data.talk_id,xopenid:o.data.xopenid,author:o.data.author};n.id=a,n.num=t,n.m=params.chatList,n.top=l,invoke({url:"",data:n,fun:function(e){var i=$("#main_navbar a[dataType='chat']").find("span");if("dom"==typeOf(i[0])){var a=i.html();console.log(a),WSnum.chat=parseInt(WSnum.chat)+parseInt(a)}if(i.remove(),e){if(o.refresh_chat(e),e.length>=t)return $("#chatBox").append('<a href="javascript:;" class="weui-btn weui-btn_default " id="btn_more">加载更多</a>'),void $(o.ele.nowLoding).remove();if(""==l){s=$("#btn_more")[0];return"dom"==typeOf(s)&&$(s).remove(),$("#chatBox").append('<div class="weui-loadmore weui-loadmore_line"><span class="weui-loadmore__tips">暂无数据</span></div>'),void $(o.ele.nowLoding).remove()}l="",n.num=t-e.length,n.id="0",o.get_chatList(n)}else{if(!l){var s=$("#btn_more")[0];return"dom"==typeOf(s)&&$(s).remove(),$("#chatBox").append('<div class="weui-loadmore weui-loadmore_line"><span class="weui-loadmore__tips">暂无数据</span></div>'),void $(o.ele.nowLoding).remove()}l="",n.num=t,n.id="0",o.get_chatList(n)}}})},this.get_broadList=function(e){var i=o.data,a="<script>var mySwiper = new Swiper('.swiper-container', {autoplay: 5000,});<\/script>";invoke({data:{m:params.broadList,talk_id:i.talk_id,xopenid:i.xopenid,author:i.author},fun:function(e){for(var i="",t=0;t<e.length;t++){var o=e[t],n=o.image,s=(o.title,""==o.url?"":"href='"+o.url+"'");i+='<div class="swiper-slide"><div class="swiper-slide-a" style="background-image: url('+n+')" dataType="'+encodeURIComponent(JSON.stringify(o))+'"><a '+s+"></a></div></div>"}var d='<div class="swiper-container"><div class="swiper-wrapper">'+i+"</div></div>"+a;$(".page_bn").html(d)},err:function(e){$(".page_bn").html('  <div class="swiper-container">                                <div class="swiper-wrapper">                                    <div class="swiper-slide"><a class="swiper-slide-a"></a></div>                                </div>                            </div><script>var mySwiper = new Swiper(\'.swiper-container\', {autoplay: 5000,});<\/script>')}})},this.get_wonderList=function(e){var i=(e||{}).page||1,a={m:params.wonderList,type:1,num:6,page:i,talk_id:o.data.talk_id,xopenid:o.data.xopenid,author:o.data.author};invoke({data:a,fun:function(e){var i=$("#main_navbar a[dataType='wonder']").find("span");if("dom"==typeOf(i[0])){var a=i.html();console.log(a),WSnum.wonder=parseInt(WSnum.wonder)+parseInt(a)}i.remove(),$(o.ele.nowLoding).remove();var t=o.dom_wonderList(e.list),n=Math.ceil(e.total/6),s=e.curr;if("dom"==typeOf($("#wonder")[0]))$("#chatBox").append(t[0]);else{var d='<div class="weui-cells" id="wonder">'+t[1]+"</div>";$("#chatBox").html(d)}n!=s?$("#chatBox").append('<a class="weui-btn weui-btn_default " id="btn_more">加载更多</a>'):$("#chatBox").append('<div class="weui-loadmore weui-loadmore_line"><span class="weui-loadmore__tips">暂无数据</span></div>')}})},this.del_chat=function(e){var a,t=e||{},s=t.id,d=t.type,r=o.data;switch(n){case"host":a=params.presideDelRepo;break;case"wonder":a=params.wonderDelRepo;break;case"chat":a="speak"==d?params.delSpeak:params.delRepo}invoke({data:{m:a,id:s,talk_id:r.talk_id,xopenid:r.xopenid,author:r.author},fun:function(e){0==i.siblings().length&&i.closest(".rep_box_repo").fadeOut(function(){this.remove()}),i.fadeOut(function(){this.remove()})}})},this.send_words=function(e){var i=o.ele.emoji.value,a=o.data,t=e||{},n=t.type||0,s="";if(-1==i.indexOf("|")){switch(n){case 1:s=i+"|"+t.msg;break;case 2:s=t.msg;break;default:s=i}o.send_check(s)&&invoke({data:{m:params.chatSpeak,message:s,type:n,talk_id:a.talk_id,xopenid:a.xopenid,author:a.author},fun:function(e){WSnum.chat=parseInt(WSnum.chat)+1;var i=e,a=o.data;a.id=i,a.message=s,a.rtype=n||"0",a.fstatus="0",a.date="刚刚",$("#chatBox").prepend(o.dom_chatLine(a)),$(o.ele.comment).remove(),o.toggle_video(),ws.send('{"talk_id":"'+TID+'","cmdtype":"getchatinfo","from":"wxchatxiaomai","to":"wxchatxiaomai","rtype":1}')}})}else alert("不要出现特殊字符")},this.send_repo=function(e){var a=o.ele.emoji.value,t={host:params.presideRepo,chat:params.chatRepo},s=o.data,r=e||{},l=r.msg||a,c=d._id||d.id,p=d.uid,u=t[n];o.send_check(l)&&invoke({data:{m:u,message:l,cid:c,pid:p,talk_id:s.talk_id,xopenid:s.xopenid,author:s.author},fun:function(e){var a=i.find(".rep_box_repo");if("dom"==typeOf(a[0])){var t=s.head,n=s.nickname,r=l,c=' <div class="weui-media-box weui-media-box_appmsg"">                                            <div class="weui-media-box__hd">                                                <img class="weui-media-box__thumb" src="'+t+'" alt="">                                            </div>                                            <div class="weui-media-box__bd">                                                <h4 class="weui-media-box__title">'+n+'</h4>                                                <p class="weui-media-box__desc">'+decodeURIComponent(r)+"</p>                                            </div>                                       </div>";a.find(".rep_item").prepend(c)}else if(d._id){var t=s.head,n=s.nickname,r=l,c=' <div class="weui-media-box weui-media-box_appmsg"">                                            <div class="weui-media-box__hd">                                                <img class="weui-media-box__thumb" src="'+t+'" alt="">                                            </div>                                            <div class="weui-media-box__bd">                                                <h4 class="weui-media-box__title">'+n+'</h4>                                                <p class="weui-media-box__desc">'+decodeURIComponent(r)+"</p>                                            </div>                                       </div>";i.after(c)}else{var p={list:[{head:s.head,nickname:s.nickname,message:l}]},u=o.dom_repo(p)[0];i.find(".weui-media-box__bd").append(u)}$(o.ele.comment).slideDown("fast",function(){o.toggle_video()}).remove()}})},this.send_wonder=function(){var e=o.ele.emoji.value,i={message:e,m:params.wonderRepo,cid:u.id,pid:"",talk_id:o.data.talk_id,xopenid:o.data.xopenid,author:o.data.author};o.send_check(e)&&invoke({data:i,fun:function(i){$(o.ele.comment).slideDown("fast").remove(),o.toggle_video();var a={head:o.data.head,nickname:o.data.nickname,date:"刚刚",message:e},t=o.dom_chatLine(a);console.log(t),$("#wonderChat").prepend(t)}})},this.send_retort=function(){var e=o.data,a={host:params.presideRetort,chat:params.chatRetort},t=d.id,s=a[n];invoke({data:{m:s,cid:t,talk_id:e.talk_id,xopenid:e.xopenid,author:e.author},fun:function(e){var a=i.find(".rep_box_retort"),t=e,n=o.data.head,s=i.attr("dataType");if(s=JSON.parse(decodeURIComponent(s)),s.retort=[t],s=encodeURIComponent(JSON.stringify(s)),i.attr("dataType",s),"dom"==typeOf(a[0]))a.find(".rep_item").prepend('<img class="rep_head" src="'+n+'" id="retort_'+t+'">');else{var d={list:[{head:o.data.head,uid:o.data.uid,id:t}]};i.find(".rep_info").after(o.dom_retort(d)[0])}}})},this.del_retort=function(){var e=o.data,a={host:params.presideDelReto,chat:params.delRetort}[n],t=d.id,s=d.retort[0];console.log(d),invoke({data:{m:a,id:t,talk_id:e.talk_id,xopenid:e.xopenid,author:e.author},fun:function(){var e=i.attr("dataType");(e=JSON.parse(decodeURIComponent(e))).retort=0,e=encodeURIComponent(JSON.stringify(e)),i.attr("dataType",e);var a="#retort_"+s,t=$(""+a),o=t.closest(".rep_box_retort");t.fadeOut(function(){this.remove()}),0==t.siblings().length&&o.fadeOut(function(){this.remove()})}})},this.getImg=function(e,i){var a,t=i||p,n=e,s=t.length,d=t[n];n>=s||0==s||(console.log(t),o.weixin.img.download({id:d,fun2:function(e){a=parseInt(n)+1,alert(e),alert(n),window.__wxjs_is_wkwebview?wx.getLocalImgData({localId:e,success:function(e){var i=e.localData;$("#"+d).attr("src",i),$("#"+d).css("height",""),o.getImg(a,t)}}):($("#"+d).attr("src",e),$("#"+d).css("height",""),o.getImg(a,t))}}),p=[])},this.playVideo=function(){var e,i;3==o.bkblInfo.model?(e=o.bkblInfo.source,i='<iframe id="" style="width:100%;height:100%;position:absolute;" frameborder="0" src="./playMp4.html?source='+encodeURIComponent(e)+'"></iframe>',$("#video").html(i)):$.ajax({url:o.bkblInfo.source,dataType:"jsonp",success:function(a){e=a.data.liveurl,i='<iframe id="" style="width:100%;height:100%;position:absolute;" frameborder="0" src="./playHls.html?source='+encodeURIComponent(e)+'"></iframe>',$("#video").html(i)}})},this.send_check=function(e){return""==e?(alert("请输入内容"),!1):!(strlen(e)>=200)||(alert("输入内容不要超过100个字"),!1)},this.toggle_video=function(e){var i,a=$("#video"),t=$(".viewType"),o={position:"absolute",top:"-100000px"},n={position:"relative",top:"0"};i=e||""?o:n,a.css(i),t.css(i)},this.audio_t=function(e){var i=e,a=Math.ceil(i.duration);$(i).siblings("a");alert(a)},this.audio_play=function(e){var i=e,a=$(e).siblings(".btn_playRecord2").find(".audioPlaying")[0];$(e).siblings(".btn_playRecord2").find(".voiceTime")[0],Math.ceil(i.duration);$(a).show(),o.audio_playing=!0,o.audio_playEle=i},this.audio_time=function(e,i){var a=e,t=i;$(a).html(t+'"'),o.audio_timeout=setTimeout(function(){console.log(t);var e=t-1;z_init.audio_time(a,e)},1e3)},this.audio_stop=function(e){var i=$(e).siblings(".btn_playRecord2").find(".audioPlaying")[0];$(e).siblings(".btn_playRecord2").find(".voiceTime")[0];$(i).hide(),delete o.audio_playing,delete o.audio_playEle}}function wsInit(){window.ws=new WebSocket(URL_socket),ws.onopen=function(){},ws.onmessage=function(e){var i=JSON.parse(e.data),a=i.data;switch(i.cmdtype){case"getchatinfo":if(NUM=a,console.log(NUM),WSnum){if(WSnum.host!=a.subject){o='主持<span class="weui-badge">'+(t=parseInt(a.subject)-parseInt(WSnum.host))+"</span>";$("#main_navbar a[dataType='host']").html(o)}if(WSnum.wonder!=a.special){o='精彩<span class="weui-badge">'+(t=parseInt(a.special)-parseInt(WSnum.wonder))+"</span>";$("#main_navbar a[dataType='wonder']").html(o)}if(WSnum.chat!=a.chatroom){var t=parseInt(a.chatroom)-parseInt(WSnum.chat),o='聊天<span class="weui-badge">'+t+"</span>";$("#main_navbar a[dataType='chat']").html(o)}}else window.WSnum={},WSnum.host=NUM.subject,WSnum.wonder=NUM.special,WSnum.chat=NUM.chatroom;break;case"changechatinfo":if(1==a.type){var n=z_init.data;invoke({data:{m:params.bkbl,talk_id:n.talk_id,xopenid:n.xopenid,author:n.author},fun:function(e){z_init.bkblInfo=e,z_init.checkPW(e)}})}else z_init.get_broadList()}},ws.onclose=function(){wsInit()},ws.onerror=function(e){}}var WSnum="",NUM="",au;$(document).ready(function(e){new Swiper(".swiper-container",{autoplay:5e3});getAtoken(),z_init.init()}),wsInit();var z_init=new Z_init;wx.ready(function(){function e(e){wx.onMenuShareAppMessage(e),wx.onMenuShareTimeline(e),wx.onMenuShareQQ(e),wx.onMenuShareWeibo(e),wx.onMenuShareQZone(e)}invoke({data:{m:params.getShare,talk_id:TID},fun:function(i){e({title:i.title,desc:i.desc,imgUrl:i.image,link:i.url,success:function(){},cancel:function(){}})},err:function(i){e("")}}),wx.onVoicePlayEnd({success:function(e){e.localId;if(z_init.voice_playEle){var i=z_init.voice_playEle;z_init.voice_playId;$(i).hide(),delete z_init.voice_playId,delete z_init.voice_playing,delete z_init.voice_playEle}}})});